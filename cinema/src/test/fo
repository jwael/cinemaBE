@ParameterizedTest
@CsvSource(
    // contactRole, startDate, endDate, expectedRoleId, expectedStatus, responseStatus
    "PARTNER, 01/01/2024, 31/12/2024, ROLE_PARTNER_123, OK, OK",
    "MANAGER, 01/01/2024, null, ROLE_MANAGER_456, OK, OK", 
    "ADMIN, 01/01/2024, 30/06/2024, ROLE_ADMIN_789, OK, OK",
    "USER, null, null, ROLE_USER_999, WARNING, WARNING"
)
fun `createCrmRole with successful response should return correct payload`(
    contactRole: String,
    startDate: String,  
    endDate: String?,   
    expectedRoleId: String,
    expectedStatus: String,
    responseStatus: String
) {
    // Given
    val dateFormatter = DateTimeFormatter.ofPattern("dd/MM/yyyy")
    
    val roleData = createCrmRoleData(
        contactRole = contactRole,
        // Utilisation du formatter pour le format dd/MM/yyyy
        startDate = if (startDate == "null") null else LocalDate.parse(startDate, dateFormatter),
        endDate = if (endDate == "null") null else endDate?.let { LocalDate.parse(it, dateFormatter) }
    )
    
    val roleResponse = RoleResponse(
        status = responseStatus,
        message = "Operation successful", 
        roleId = expectedRoleId
    )
    val rolesResponse = RolesResponse(roles = listOf(roleResponse))
    
    every { 
        crmClient.createRole(
            correlationId = any(),
            contactId = "CONTACT_123",
            roleRequest = any()
        ).execute() 
    } returns Response.success(rolesResponse)

    // When
    val result = adapter.createCrmRole(roleData)

    // Then
    assertEquals(expectedRoleId, result.crmRoleId)
    assertEquals(RecordStepStatus.valueOf(expectedStatus), result.crmStatus)
    assertEquals("Operation successful", result.crmMessage)
    
    verify { 
        crmClient.createRole(
            correlationId = any(),
            contactId = "CONTACT_123",
            roleRequest = any()
        ).execute() 
    }
}